<script>
  const app = document.getElementById('app');

  let categories = [];
  let notes = {}; // categoryName: [{id, title, text}]
  let view = "home"; // "home" | categoryName | "note"
  let selectedNote = null;

  function render() {
    // Clear everything inside #app
    app.innerHTML = "";

    // Remove any old floating buttons
    document.querySelectorAll(".floating-btn").forEach(btn => btn.remove());

    if (view === "home") {
      const container = document.createElement("div");
      categories.forEach(cat => {
        const div = document.createElement("div");
        div.className = "category";
        div.textContent = cat;
        div.onclick = () => { view = cat; render(); };
        container.appendChild(div);
      });
      app.appendChild(container);
    } else if (categories.includes(view)) {
      const container = document.createElement("div");
      notes[view].forEach(note => {
        const div = document.createElement("div");
        div.className = "note-card";
        div.textContent = note.title;
        div.onclick = () => {
          selectedNote = note;
          view = "note";
          render();
        };
        container.appendChild(div);
      });
      app.appendChild(container);
    } else if (view === "note" && selectedNote) {
      const div = document.createElement("div");
      div.className = "center";
      const title = document.createElement("h1");
      title.style.fontSize = "2em";
      title.textContent = selectedNote.title;
      const text = document.createElement("p");
      text.style.fontSize = "1em";
      text.textContent = selectedNote.text;
      div.appendChild(title);
      div.appendChild(text);

      const editBtn = document.createElement("button");
      editBtn.className = "btn btn-round";
      editBtn.textContent = "Edit";
      editBtn.onclick = () => {
        const newTitle = prompt("Edit title:", selectedNote.title);
        const newText = prompt("Edit text:", selectedNote.text);
        if (newTitle != null && newText != null) {
          selectedNote.title = newTitle;
          selectedNote.text = newText;
          render();
        }
      };
      div.appendChild(editBtn);

      app.appendChild(div);
    }

    // Back button (except on home)
    if (view !== "home") {
      const backBtn = document.createElement("button");
      backBtn.className = "btn btn-round top-left floating-btn";
      backBtn.textContent = "â† Back";
      backBtn.onclick = () => { view = "home"; render(); };
      document.body.appendChild(backBtn);
    }

    // Create Category Button
    const createCatBtn = document.createElement("button");
    createCatBtn.className = "btn btn-round bottom-left floating-btn";
    createCatBtn.textContent = "+ Create Category";
    createCatBtn.onclick = () => {
      const name = prompt("Name your category");
      if (name && !categories.includes(name)) {
        categories.push(name);
        notes[name] = [];
        render();
      }
    };
    document.body.appendChild(createCatBtn);

    // Create Note Button
    const createNoteBtn = document.createElement("button");
    createNoteBtn.className = "btn btn-circle bottom-right floating-btn";
    createNoteBtn.textContent = "+ Create Note";
    createNoteBtn.onclick = () => {
      if (categories.length === 0) return alert("No categories yet!");
      const category = prompt("What category?\n" + categories.join(", "));
      if (category && categories.includes(category)) {
        const title = prompt("Note title:");
        if (title) {
          const newNote = { id: Date.now(), title, text: "" };
          notes[category].push(newNote);
          render();
        }
      }
    };
    document.body.appendChild(createNoteBtn);
  }

  render();
</script>
